"use strict";(()=>{var t={};t.id=744,t.ids=[744],t.modules={399:t=>{t.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:t=>{t.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:t=>{t.exports=require("buffer")},2048:t=>{t.exports=require("fs")},629:t=>{t.exports=require("fs/promises")},5315:t=>{t.exports=require("path")},9573:(t,e,r)=>{r.r(e),r.d(e,{originalPathname:()=>D,patchFetch:()=>j,requestAsyncStorage:()=>E,routeModule:()=>w,serverHooks:()=>S,staticGenerationAsyncStorage:()=>y});var a={};r.r(a),r.d(a,{GET:()=>g,POST:()=>$});var n=r(9303),o=r(8716),i=r(3131),s=r(7070),c=r(629),u=r.n(c),p=r(5315),l=r.n(p),m=r(4027);let d=l().resolve(process.cwd(),"../../.."),h=l().join(d,"runtime");function f(t,e){switch(t){case"workstream":return l().join(h,"workstreams",e.name,"chat.md");case"program":return l().join(h,"workstreams",e.workstream,"programs",e.program,"chat.md");case"project":return l().join(h,"workstreams",e.workstream,"programs",e.program,"projects",e.project,"chat.md");case"task":return l().join(h,"loops",`${e.id}.md`);default:throw Error(`Invalid chat scope: ${t}`)}}async function g(t){let{searchParams:e}=new URL(t.url),r=e.get("scope"),a=Object.fromEntries(e.entries());if(!r)return s.NextResponse.json({message:"Missing scope parameter"},{status:400});try{let t=f(r,a),e=await u().readFile(t,"utf-8"),n=function(t,e){if("task"===e){let e=t.match(/## ðŸ’¬ Chat\n([\s\S]*)/);t=e?e[1]:""}let r=[];for(let e of t.split("- timestamp:").slice(1)){let t=e.match(/(.*?)\n/),a=e.match(/speaker: (user|ora)/),n=e.match(/message: ([\s\S]*)/);t&&a&&n&&r.push({timestamp:t[1].trim(),speaker:a[1],message:n[1].trim()})}return r}(e,r);return s.NextResponse.json(n)}catch(t){if(t instanceof Error&&"ENOENT"===t.code)return s.NextResponse.json([]);return console.error("Failed to get chat:",t),s.NextResponse.json({message:`Failed to get chat for ${r}`},{status:500})}}async function $(t){let{scope:e,params:r,message:a}=await t.json();if(!e||!r||!a)return s.NextResponse.json({message:"Missing required parameters"},{status:400});let n={timestamp:new Date().toISOString(),...a};try{let t=f(e,r),a=`
- timestamp: ${n.timestamp}
  speaker: ${n.speaker}
  message: ${n.message}
`;return"task"===e?await m.n.appendToSection(t,"## \uD83D\uDCAC Chat",a,r.id):(await u().mkdir(l().dirname(t),{recursive:!0}),await u().appendFile(t,a,"utf-8")),s.NextResponse.json(n,{status:201})}catch(t){return console.error("Failed to post chat message:",t),s.NextResponse.json({message:`Failed to post chat for ${e}`},{status:500})}}let w=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/chat/route",pathname:"/api/chat",filename:"route",bundlePath:"app/api/chat/route"},resolvedPagePath:"/Users/air/Projects/ora-system/src/ui/react-app/app/api/chat/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:E,staticGenerationAsyncStorage:y,serverHooks:S}=w,D="/api/chat/route";function j(){return(0,i.patchFetch)({serverHooks:S,staticGenerationAsyncStorage:y})}},4027:(t,e,r)=>{r.d(e,{n:()=>w});var a=r(629),n=r.n(a),o=r(5315),i=r.n(o),s=r(9744),c=r.n(s),u=r(6314);let p=["## Purpose","## âœ… Objectives","## \uD83D\uDD27 Tasks","## \uD83E\uDDFE Execution Log","## \uD83E\uDDE0 Memory Trace"],l=i().resolve(__dirname,"../../"),m=i().join(l,"runtime","logs","mutation-log.json"),d=i().join(l,"runtime","logs","mutation-errors.json");async function h(t){let e=await n().readFile(t,"utf-8");return c()(e,u.G)}async function f(t,e){let r=c().stringify(e.content,e.data);await n().writeFile(t,r,"utf-8")}async function g(t){let e={timestamp:new Date().toISOString(),...t},r=[];try{let t=await n().readFile(m,"utf-8");r=JSON.parse(t)}catch(t){}r.push(e),await n().writeFile(m,JSON.stringify(r,null,2),"utf-8")}async function $(t){let e={timestamp:new Date().toISOString(),...t},r=[];try{let t=await n().readFile(d,"utf-8");r=JSON.parse(t)}catch(t){}r.push(e),await n().writeFile(d,JSON.stringify(r,null,2),"utf-8")}let w={async patchFrontmatter(t,e,r){let a=await h(t);a.data,a.data={...a.data,...e},await f(t,a),await g({filePath:t,mutationType:"PATCH_FRONTMATTER",summary:`Updated frontmatter. Changes: ${JSON.stringify(e)}`,loopOrTaskUuid:r})},async appendToSection(t,e,r,a){let n=await h(t);if(RegExp(`(^${e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}[\\s\\S]*?)(?=\\n## |$)`,"m"),!n.content.includes(e))throw Error(`Validation Error: Section "${e}" not found in ${t}.`);n.content=n.content.replace(e,`${e}
${r}`),await f(t,n),await g({filePath:t,mutationType:"APPEND_TO_SECTION",summary:`Appended content to section "${e}".`,loopOrTaskUuid:a})},async replaceInSection(t,e,r,a,n){let o=await h(t),i=RegExp(`(^${e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}[\\s\\S]*?)(?=\\n## |$)`,"m"),s=o.content.match(i);if(!s){let r=Error(`Validation Error: Section "${e}" not found in ${t}.`);throw await $({filePath:t,mutationType:"REPLACE_IN_SECTION",error:r.message,loopOrTaskUuid:n}),r}let c=s[0],u=c.replace(r,a);c!==u&&(o.content=o.content.replace(c,u),await f(t,o),await g({filePath:t,mutationType:"REPLACE_IN_SECTION",summary:`Replaced content in section "${e}".`,loopOrTaskUuid:n}))},async appendToLog(t,e){let r=await h(t),a="## \uD83E\uDDFE Execution Log";if(!r.content.includes(a))throw Error(`Validation Error: Section "${a}" not found in ${t}.`);let n=`- ${e.timestamp}: ${"ora"===e.actor?"\uD83E\uDD16":"\uD83D\uDC64"} ${e.action}`,o=RegExp(`(${a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}[\\s\\S]*?)(?=\\n## |$)`,"m"),i=r.content.match(o);if(!i)throw Error(`Validation Error: Section "${a}" malformed in ${t}.`);let s=i[0],c=s.endsWith("\n")?`${s}${n}
`:`${s}
${n}
`;r.content=r.content.replace(s,c),await f(t,r),await g({filePath:t,mutationType:"APPEND_TO_LOG",summary:`Appended log entry: ${e.action}`})},async validateMarkdownSchema(t,e=p){let r;try{r=await n().readFile(t,"utf-8")}catch(e){throw Error(`Validation Error: File not found or unreadable at ${t}`)}let a=[],o={};for(let t of e){let e=RegExp(`^${t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}`,"gm"),n=r.match(e),i=n?n.length:0;o[t]=i,0===i?a.push(`Missing required section: "${t}"`):i>1&&a.push(`Duplicated section: "${t}" (found ${i} times)`)}for(let t of r.match(/^## .+$/gm)||[])if(e.includes(t)){let e=RegExp(`(^${t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}[\\s\\S]*?)(?=\\n## |$)`,"m"),a=r.match(e);a&&(a[0].trim(),t.trim())}if(a.length>0)throw Error(`Validation Error in ${t}:
${a.join("\n")}`)},async dryRunMutation(t,e){let r,a;try{r=await n().readFile(t,"utf-8")}catch(e){throw Error(`Dry Run Error: Cannot read file at ${t}`)}try{a=e(r)}catch(t){throw Error(`Dry Run Error: Mutation function failed: ${t}`)}let o=r===a?void 0:"Content changed";return{preImage:r,postImage:a,diff:o}}}},6314:(t,e,r)=>{r.d(e,{G:()=>n});var a=r(3366);let n={engines:{yaml:{parse:t=>a.ZP.load(t,{schema:a.ZP.JSON_SCHEMA}),stringify:t=>a.ZP.dump(t)}}}}};var e=require("../../../webpack-runtime.js");e.C(t);var r=t=>e(e.s=t),a=e.X(0,[276,972,366,127],()=>r(9573));module.exports=a})();