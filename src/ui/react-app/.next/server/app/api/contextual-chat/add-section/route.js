"use strict";(()=>{var e={};e.id=655,e.ids=[655],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4770:e=>{e.exports=require("crypto")},629:e=>{e.exports=require("fs/promises")},5315:e=>{e.exports=require("path")},7530:(e,t,n)=>{n.r(t),n.d(t,{originalPathname:()=>y,patchFetch:()=>w,requestAsyncStorage:()=>$,routeModule:()=>m,serverHooks:()=>x,staticGenerationAsyncStorage:()=>f});var o={};n.r(o),n.d(o,{POST:()=>g});var s=n(9303),a=n(8716),r=n(3131),i=n(7070),c=n(629),u=n.n(c),l=n(5315),d=n.n(l),p=n(4810);let h=d().resolve(process.cwd(),"../../..");async function g(e){let{contextType:t,contextId:n,filePath:o}=await e.json();if(!t||!n)return i.NextResponse.json({message:"Missing contextType or contextId parameter"},{status:400});try{if(!o)return i.NextResponse.json({message:"Missing filePath parameter"},{status:400});let e=d().join(h,o);try{await u().access(e)}catch(e){return i.NextResponse.json({message:`File not found: ${o}`},{status:404})}let s=await u().readFile(e,"utf-8");if(s.includes("## \uD83D\uDCAC Chat"))return i.NextResponse.json({message:"Chat section already exists in this file"},{status:200});await u().writeFile(e,s+"\n\n## \uD83D\uDCAC Chat\n\n","utf-8");try{await (0,p._b)("add-chat-section",`Added chat section to file: ${o}`,`Chat section successfully added to ${o}`,"ora","api",{contextType:t,contextId:n,filePath:o,action:"add-section"})}catch(e){console.error("Failed to log add-section interaction:",e)}return i.NextResponse.json({message:"Chat section added successfully",filePath:o},{status:200})}catch(e){return console.error("Failed to add chat section:",e),i.NextResponse.json({message:`Failed to add chat section: ${e instanceof Error?e.message:"Unknown error"}`},{status:500})}}let m=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/contextual-chat/add-section/route",pathname:"/api/contextual-chat/add-section",filename:"route",bundlePath:"app/api/contextual-chat/add-section/route"},resolvedPagePath:"/Users/air/Projects/ora-system/src/ui/react-app/app/api/contextual-chat/add-section/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:$,staticGenerationAsyncStorage:f,serverHooks:x}=m,y="/api/contextual-chat/add-section/route";function w(){return(0,r.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:f})}},4810:(e,t,n)=>{n.d(t,{$7:()=>$,_b:()=>m,$Z:()=>x,A1:()=>f});var o=n(629),s=n.n(o),a=n(5315),r=n.n(a),i=n(4770);let c={randomUUID:i.randomUUID},u=new Uint8Array(256),l=u.length,d=[];for(let e=0;e<256;++e)d.push((e+256).toString(16).slice(1));let p=function(e,t,n){if(c.randomUUID&&!t&&!e)return c.randomUUID();let o=(e=e||{}).random??e.rng?.()??(l>u.length-16&&((0,i.randomFillSync)(u),l=0),u.slice(l,l+=16));if(o.length<16)throw Error("Random bytes length must be >= 16");if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t){if((n=n||0)<0||n+16>t.length)throw RangeError(`UUID byte range ${n}:${n+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[n+e]=o[e];return t}return function(e,t=0){return(d[e[t+0]]+d[e[t+1]]+d[e[t+2]]+d[e[t+3]]+"-"+d[e[t+4]]+d[e[t+5]]+"-"+d[e[t+6]]+d[e[t+7]]+"-"+d[e[t+8]]+d[e[t+9]]+"-"+d[e[t+10]]+d[e[t+11]]+d[e[t+12]]+d[e[t+13]]+d[e[t+14]]+d[e[t+15]]).toLowerCase()}(o)},h=r().resolve(process.cwd(),"../../.."),g=r().join(h,"runtime","interactions");async function m(e,t,n,o,a,i={}){try{var c;await s().mkdir(g,{recursive:!0});let u=`interaction-${Date.now()}-${p().slice(0,8)}`,l=new Date,d=l.toISOString(),{contextStr:h,tags:m}=function(e,t,n){let{contextType:o,contextId:s,action:a}=t,r=s||"unknown",i=["interaction"];return o&&(i.push(o),"loop"===o&&s?(r=s,i.push("loop-interaction")):"task"===o&&s?(r=s,i.push("task-management")):"phase"===o&&s&&(r=s,i.push("phase-interaction"))),i.push(e),a&&i.push(a),i.push(`${n}-action`),{contextStr:r,tags:i}}(e,i,o),$=function(e,t){let n=e.toISOString().replace(/T/,"-").replace(/:/g,"").replace(/\..+/,"").slice(0,15),o=t?`-${t}`:"";return`interaction-${n}${o}.md`}(l,i.contextId),f=(c={actor:o,source:a,context:h,tags:m,message:t,outcome:n},`---
uuid: ${u}
timestamp: ${d}
actor: ${c.actor}
source: ${c.source}
context: ${c.context}
tags: [${c.tags.join(", ")}]
---

## 💬 Message

${c.message}

## 🔄 Outcome

${c.outcome}
`),x=r().join(g,$);return await s().writeFile(x,f,"utf-8"),console.log(`✅ Interaction logged: ${u} -> ${$}`),u}catch(e){throw console.error("❌ Failed to log interaction:",e),e}}async function $(e,t,n,o,s){return m("chat-message",`Chat message in ${n} ${o}: "${e.substring(0,100)}${e.length>100?"...":""}"`,`Message successfully posted to ${s||`${n}/${o}`} chat history.`,t,"chat",{contextType:n,contextId:o,filePath:s,action:"post-message"})}async function f(e,t,n,o,s){return m("task-management",`Task ${e}: "${t.substring(0,100)}${t.length>100?"...":""}"`,o,n,"ui",{contextType:"task",contextId:s,action:`task-${e}`})}async function x(e,t,n,o,s){let a=`${"memory"===e?"Memory trace":"Execution log"} entry: "${t.substring(0,100)}${t.length>100?"...":""}"`,r=`Successfully logged to ${e} section in ${s||`${n}/${o}`}.`;return m(`${e}-log`,a,r,"ora","api",{contextType:n,contextId:o,filePath:s,action:`log-${e}`})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),o=t.X(0,[276,972],()=>n(7530));module.exports=o})();