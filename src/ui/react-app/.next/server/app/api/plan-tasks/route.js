"use strict";(()=>{var e={};e.id=710,e.ids=[710],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},2048:e=>{e.exports=require("fs")},629:e=>{e.exports=require("fs/promises")},5315:e=>{e.exports=require("path")},8473:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>D,patchFetch:()=>O,requestAsyncStorage:()=>T,routeModule:()=>k,serverHooks:()=>x,staticGenerationAsyncStorage:()=>S});var a={};r.r(a),r.d(a,{DELETE:()=>y,GET:()=>$,POST:()=>h,PUT:()=>w,dynamic:()=>f});var n=r(9303),s=r(8716),o=r(3131),i=r(7070),u=r(629),l=r.n(u),c=r(5315),d=r.n(c),p=r(7038),m=r(4027);let f="force-dynamic",g=d().resolve(process.cwd(),"../../.."),E=d().join(g,"runtime","workstreams","roadmap","workstream_plan.md");async function $(){try{let e=await l().readFile(E,"utf-8"),t=(0,p.Y)(e);return i.NextResponse.json(t)}catch(t){if(t instanceof Error&&"ENOENT"===t.code)return i.NextResponse.json([]);console.error("Failed to get plan tasks:",t);let e=t instanceof Error?t.message:"Internal Server Error";return i.NextResponse.json({message:"Failed to get plan tasks",error:e},{status:500})}}async function h(e){try{let{description:t,added_by:r,context:a}=await e.json();if(!t||!r)return i.NextResponse.json({message:"Missing required fields"},{status:400});let n={description:t,added_by:r,status:"pending",source:`plan: ${d().basename(E)}`,context:a},s=(0,p.O)([{...n,id:"",section:"User-Defined Tasks"}],"");return await m.n.appendToSection(E,"user"===r?"### User-Defined Tasks":"### Ora-Suggested Tasks",s),i.NextResponse.json(n,{status:201})}catch(t){console.error("Failed to add task:",t);let e=t instanceof Error?t.message:"Internal Server Error";return i.NextResponse.json({message:"Failed to add task",error:e},{status:500})}}async function w(e){try{let t=await e.json(),r=await l().readFile(E,"utf-8"),a=(0,p.Y)(r).find(e=>e.id===t.id);if(!a)return i.NextResponse.json({message:"Task not found"},{status:404});let n=(0,p.O)([a],""),s=(0,p.O)([t],""),o="User-Defined Tasks"===t.section?"### User-Defined Tasks":"### Ora-Suggested Tasks";return await m.n.replaceInSection(E,o,n,s,t.id),i.NextResponse.json(t)}catch(t){console.error("Failed to update task:",t);let e=t instanceof Error?t.message:"Internal Server Error";return i.NextResponse.json({message:"Failed to update task",error:e},{status:500})}}async function y(e){try{let{id:t}=await e.json();if(!t)return i.NextResponse.json({message:"Missing task id"},{status:400});let r=await l().readFile(E,"utf-8"),a=(0,p.Y)(r).find(e=>e.id===t);if(!a)return i.NextResponse.json({message:"Task not found"},{status:404});let n=(0,p.O)([a],""),s="User-Defined Tasks"===a.section?"### User-Defined Tasks":"### Ora-Suggested Tasks";return await m.n.replaceInSection(E,s,n,"",t),i.NextResponse.json({message:"Task deleted successfully"})}catch(t){console.error("Failed to delete task:",t);let e=t instanceof Error?t.message:"Internal Server Error";return i.NextResponse.json({message:"Failed to delete task",error:e},{status:500})}}d().join(g,"runtime","backups");let k=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/plan-tasks/route",pathname:"/api/plan-tasks",filename:"route",bundlePath:"app/api/plan-tasks/route"},resolvedPagePath:"/Users/air/Projects/ora-system/src/ui/react-app/app/api/plan-tasks/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:T,staticGenerationAsyncStorage:S,serverHooks:x}=k,D="/api/plan-tasks/route";function O(){return(0,o.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:S})}},4027:(e,t,r)=>{r.d(t,{n:()=>h});var a=r(629),n=r.n(a),s=r(5315),o=r.n(s),i=r(9744),u=r.n(i),l=r(6314);let c=["## Purpose","## âœ… Objectives","## \uD83D\uDD27 Tasks","## \uD83E\uDDFE Execution Log","## \uD83E\uDDE0 Memory Trace"],d=o().resolve(__dirname,"../../"),p=o().join(d,"runtime","logs","mutation-log.json"),m=o().join(d,"runtime","logs","mutation-errors.json");async function f(e){let t=await n().readFile(e,"utf-8");return u()(t,l.G)}async function g(e,t){let r=u().stringify(t.content,t.data);await n().writeFile(e,r,"utf-8")}async function E(e){let t={timestamp:new Date().toISOString(),...e},r=[];try{let e=await n().readFile(p,"utf-8");r=JSON.parse(e)}catch(e){}r.push(t),await n().writeFile(p,JSON.stringify(r,null,2),"utf-8")}async function $(e){let t={timestamp:new Date().toISOString(),...e},r=[];try{let e=await n().readFile(m,"utf-8");r=JSON.parse(e)}catch(e){}r.push(t),await n().writeFile(m,JSON.stringify(r,null,2),"utf-8")}let h={async patchFrontmatter(e,t,r){let a=await f(e);a.data,a.data={...a.data,...t},await g(e,a),await E({filePath:e,mutationType:"PATCH_FRONTMATTER",summary:`Updated frontmatter. Changes: ${JSON.stringify(t)}`,loopOrTaskUuid:r})},async appendToSection(e,t,r,a){let n=await f(e);if(RegExp(`(^${t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}[\\s\\S]*?)(?=\\n## |$)`,"m"),!n.content.includes(t))throw Error(`Validation Error: Section "${t}" not found in ${e}.`);n.content=n.content.replace(t,`${t}
${r}`),await g(e,n),await E({filePath:e,mutationType:"APPEND_TO_SECTION",summary:`Appended content to section "${t}".`,loopOrTaskUuid:a})},async replaceInSection(e,t,r,a,n){let s=await f(e),o=RegExp(`(^${t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}[\\s\\S]*?)(?=\\n## |$)`,"m"),i=s.content.match(o);if(!i){let r=Error(`Validation Error: Section "${t}" not found in ${e}.`);throw await $({filePath:e,mutationType:"REPLACE_IN_SECTION",error:r.message,loopOrTaskUuid:n}),r}let u=i[0],l=u.replace(r,a);u!==l&&(s.content=s.content.replace(u,l),await g(e,s),await E({filePath:e,mutationType:"REPLACE_IN_SECTION",summary:`Replaced content in section "${t}".`,loopOrTaskUuid:n}))},async appendToLog(e,t){let r=await f(e),a="## \uD83E\uDDFE Execution Log";if(!r.content.includes(a))throw Error(`Validation Error: Section "${a}" not found in ${e}.`);let n=`- ${t.timestamp}: ${"ora"===t.actor?"\uD83E\uDD16":"\uD83D\uDC64"} ${t.action}`,s=RegExp(`(${a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}[\\s\\S]*?)(?=\\n## |$)`,"m"),o=r.content.match(s);if(!o)throw Error(`Validation Error: Section "${a}" malformed in ${e}.`);let i=o[0],u=i.endsWith("\n")?`${i}${n}
`:`${i}
${n}
`;r.content=r.content.replace(i,u),await g(e,r),await E({filePath:e,mutationType:"APPEND_TO_LOG",summary:`Appended log entry: ${t.action}`})},async validateMarkdownSchema(e,t=c){let r;try{r=await n().readFile(e,"utf-8")}catch(t){throw Error(`Validation Error: File not found or unreadable at ${e}`)}let a=[],s={};for(let e of t){let t=RegExp(`^${e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}`,"gm"),n=r.match(t),o=n?n.length:0;s[e]=o,0===o?a.push(`Missing required section: "${e}"`):o>1&&a.push(`Duplicated section: "${e}" (found ${o} times)`)}for(let e of r.match(/^## .+$/gm)||[])if(t.includes(e)){let t=RegExp(`(^${e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}[\\s\\S]*?)(?=\\n## |$)`,"m"),a=r.match(t);a&&(a[0].trim(),e.trim())}if(a.length>0)throw Error(`Validation Error in ${e}:
${a.join("\n")}`)},async dryRunMutation(e,t){let r,a;try{r=await n().readFile(e,"utf-8")}catch(t){throw Error(`Dry Run Error: Cannot read file at ${e}`)}try{a=t(r)}catch(e){throw Error(`Dry Run Error: Mutation function failed: ${e}`)}let s=r===a?void 0:"Content changed";return{preImage:r,postImage:a,diff:s}}}},7038:(e,t,r)=>{r.d(t,{O:()=>i,Y:()=>o});var a=r(5315),n=r.n(a);let s=n().resolve(process.cwd(),"../../../runtime/workstreams/roadmap/workstream_plan.md"),o=e=>{let t=[],r=null,a=e.split("\n");for(let e=0;e<a.length;e++){let o=a[e].trim(),i=o.match(/^### (User-Defined Tasks|Ora-Suggested Tasks)/);if(i){r=i[1];continue}if(!r)continue;let u=o.match(/^- \[([ x-])\] (.*)/);if(u){let[o,i,l]=u,c={description:l.trim(),status:"x"===i?"done":"pending",section:r,id:Buffer.from(l.trim()).toString("base64"),added_by:"user",source:`plan: ${n().basename(s)}`},d=e+1;for(;d<a.length;){let e=a[d].trim();if(e.startsWith("- [")||e.startsWith("###")||"---"===e)break;let t=e.match(/`([^`]+?):\s*([^`]+?)`/);if(t){let[e,r,a]=t;c[r.trim()]=a.trim()}else e&&(c.description+="\n"+a[d]);d++}"promoted"===c.status&&(c.status="promoted"),t.push(c),e=d-1}}return t},i=(e,t)=>{let r=e.filter(e=>"User-Defined Tasks"===e.section&&"rejected"!==e.status),a=e.filter(e=>"Ora-Suggested Tasks"===e.section&&"rejected"!==e.status),n=e=>{let t="done"===e.status?"[x]":"[ ]",r=`- ${t} ${e.description}
`;return r+=`  \`added_by: ${e.added_by}\`
  \`source: ${e.source}\`
`,e.context&&(r+=`  \`context: ${e.context}\`
`),e.promoted_to&&(r+=`  \`promoted_to: ${e.promoted_to}\`
`),"promoted"===e.status&&(r+="  `status: promoted`\n"),r},s=t.match(/---[\\s\\S]*?---/);return(s?s[0]:"")+"\n\n"+(`### User-Defined Tasks

`+r.map(n).join("\n")+`
---

`+`### Ora-Suggested Tasks

`)+a.map(n).join("\n")}},6314:(e,t,r)=>{r.d(t,{G:()=>n});var a=r(3366);let n={engines:{yaml:{parse:e=>a.ZP.load(e,{schema:a.ZP.JSON_SCHEMA}),stringify:e=>a.ZP.dump(e)}}}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[276,972,366,127],()=>r(8473));module.exports=a})();