"use strict";(()=>{var e={};e.id=383,e.ids=[383],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},4770:e=>{e.exports=require("crypto")},2048:e=>{e.exports=require("fs")},629:e=>{e.exports=require("fs/promises")},5315:e=>{e.exports=require("path")},6140:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>y,requestAsyncStorage:()=>v,routeModule:()=>D,serverHooks:()=>T,staticGenerationAsyncStorage:()=>j});var s={};r.r(s),r.d(s,{POST:()=>g});var o=r(9303),a=r(8716),i=r(3131),n=r(7070),p=r(629),u=r.n(p),d=r(5315),c=r.n(d),l=r(4027),m=r(7038),k=r(4810);let w=c().resolve(process.cwd(),"../../../runtime/workstreams/roadmap/workstream_plan.md"),x=c().resolve(process.cwd(),"../../../runtime/loops"),f=c().resolve(process.cwd(),"../../../runtime/workstreams");async function g(e){let{task:t,destinationType:r,destinationId:s}=await e.json();if(!t||!r||!s)return n.NextResponse.json({message:"Missing required parameters: task, destinationType, and destinationId are required."},{status:400});try{let e;let o=s;switch(r){case"new-loop":let a=`${s}.md`;e=c().join(x,a),o=a;let i=`---
id: ${s}
name: ${s}
status: active
---

## ðŸŽ¯ Goal
...

## ðŸ”§ Tasks

## ðŸ§¾ Execution Log
`;await u().writeFile(e,i,"utf-8");break;case"existing-loop":e=c().join(x,s),o=s;break;case"project-task-file":e=c().join(f,s),o=s;break;default:return n.NextResponse.json({message:`Unsupported destination type: ${r}`},{status:400})}await l.n.validateMarkdownSchema(e,["## \uD83D\uDD27 Tasks","## \uD83E\uDDFE Execution Log"]);let p=`- [ ] ${t.description}`,d=`- ${new Date().toISOString()}: Task "${t.description}" promoted from workstream_plan.md by user`;await l.n.appendToSection(e,"## \uD83D\uDD27 Tasks",p,t.id),await l.n.appendToSection(e,"## \uD83E\uDDFE Execution Log",d,t.id);let g=await u().readFile(w,"utf-8"),D=(0,m.Y)(g),v=D.findIndex(e=>e.id===t.id);if(-1===v)return n.NextResponse.json({message:"Task not found in workstream plan"},{status:404});{let e=(0,m.O)([D[v]],"");D[v].status="promoted",D[v].promoted_to=o;let r=(0,m.O)([D[v]],"");await l.n.replaceInSection(w,"### User-Defined Tasks",e,r,t.id),await l.n.replaceInSection(w,"### Ora-Suggested Tasks",e,r,t.id)}try{await (0,k.A1)("promote",t.description,"user",`Task successfully promoted to ${r}: ${o}`,t.id)}catch(e){console.error("Failed to log task promotion interaction:",e)}return n.NextResponse.json({message:"Task promoted successfully",promoted_to:o})}catch(t){console.error("Failed to promote task:",t);let e=t instanceof Error?t.message:"Internal Server Error";return n.NextResponse.json({message:`Failed to promote task: ${e}`},{status:500})}}let D=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/promote-task/route",pathname:"/api/promote-task",filename:"route",bundlePath:"app/api/promote-task/route"},resolvedPagePath:"/Users/air/Projects/ora-system/src/ui/react-app/app/api/promote-task/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:v,staticGenerationAsyncStorage:j,serverHooks:T}=D,h="/api/promote-task/route";function y(){return(0,i.patchFetch)({serverHooks:T,staticGenerationAsyncStorage:j})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[276,972,366,127,229],()=>r(6140));module.exports=s})();